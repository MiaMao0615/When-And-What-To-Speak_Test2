# ChatGPT 聊天系统启动指南

## 前置要求
1. Python 3.7+ 已安装
2. Node.js 和 npm 已安装
3. OpenAI API Key 已配置（在环境变量或 CoreChatgpt.py 中）

## 启动步骤

### 第一步：启动后端服务器

在项目根目录（`D:\Task_design`）下，打开终端运行：

```bash
python backend/WebsocketChatgpty.py
```

**成功标志：** 你应该看到类似以下输出：
```
[server_ws] booting...
[server_ws_chatgpt] starting ws://0.0.0.0:8766 (ChatGPT mode)
[log] 实验日志将保存到: experiment_logs/chatgpt_experiment_YYYYMMDD_HHMMSS.csv
```

**重要：** 保持这个终端窗口打开，不要关闭。

---

### 第二步：启动前端开发服务器

在**新的终端窗口**中，进入前端目录并启动：

```bash
cd my-chat-app2ChatgptTest
npm run dev
```

**成功标志：** 你应该看到类似以下输出：
```
  VITE v7.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

---

### 第三步：打开浏览器访问

在浏览器中打开前端地址（通常是 `http://localhost:5173/`）

---

## 使用说明

1. **填写个人信息**：首次进入需要填写昵称、简介、性格特征等信息
2. **进入聊天室**：填写完成后点击"加入聊天室"
3. **开始对话**：输入消息并发送，Agent 会根据意愿分数决定是否插话
4. **实时调整场景**：在右侧面板可以调整场景参数（时间、正式度、话题等）
5. **结束实验**：点击右侧面板的红色"结束实验"按钮，然后可以查看统计结果

---

## 实验日志

实验数据会自动保存到 `experiment_logs/` 目录下的 CSV 文件中，文件名为：
`chatgpt_experiment_YYYYMMDD_HHMMSS.csv`

---

## 故障排查

### 后端无法启动
- 检查 Python 版本：`python --version`
- 检查依赖包：`pip install websockets openai`
- 检查 OpenAI API Key 是否配置

### 前端无法连接
- 确认后端已启动并显示 `starting ws://0.0.0.0:8766`
- 检查浏览器控制台是否有 WebSocket 连接错误
- 确认前端连接的端口是 8766（在 `src/App.jsx` 第 5 行）

### 端口被占用
- 如果 8766 端口被占用，可以修改 `backend/WebsocketChatgpty.py` 第 564 行的 `WS_PORT`
- 同时修改前端 `src/App.jsx` 第 5 行的端口号

---

## 停止服务

1. **停止前端**：在运行 `npm run dev` 的终端按 `Ctrl+C`
2. **停止后端**：在运行 `python backend/WebsocketChatgpty.py` 的终端按 `Ctrl+C`
